{% extends "layout.html" %}

{% block title %}
    Portfolio
{% endblock %}

{% block main %}
<div class="container-fluid bg-dark text-center rounded p-4 shado opacity-75 table-responsive-sm">
<table class="table table-dark table-hover">
    <thead>
        <tr>
            <th class="text-start">Symbol</th>
            <th class="text-start">Name</th>
            <th class="text-end">Shares Owned</th>
            <th class="text-end">Current Price (per share)</th>
            <th class="text-end">TOTAL</th>
        </tr>
    </thead>
    <tbody>
        {% for stock in portfolio %}
            <tr>
                <td class="text-start">{{stock.stock_symbol}}</td>
                <td class="text-start">{{stock.stock_name}}</td>
                <td class="text-end">{{stock.num_shares}}</td>
                <td class="text-end">{{stock.price | usd}}</td>
                <td class="text-end">{{(stock.price * stock.num_shares) | usd}}</td>
            </tr>
        {% endfor %}

</tbody>
    <tfoot>
        <tr>
            <td class="border-0 fw-bold text-end" colspan="4">Cash</td>
            <td class="border-0 text-end">{{cash}}</td>
        </tr>
        <tr>
            <td class="border-0 fw-bold text-end" colspan="4">TOTAL Value</td>
            <td class="border-0 w-bold text-end">{{total}}</td>
        </tr>
    </tfoot>
</table>
    <div class="d-flex justify-content-xl-between container-fluid flex-sm-column flex-xl-row flex-lg-row flex-md-row flex-column">
        <form action="/buy" method="post">
            <div class="mb-3">
                <input autocomplete="off" autofocus class="form-control mx-auto w-auto" name="symbol" placeholder="Symbol" type="text">
            </div>
            <div class="mb-3">
                <input class="form-control mx-auto w-auto" name="shares" min = "1" placeholder="Number Of Shares" type="number">
            </div>
            <button class="btn btn-primary" type="submit">Buy</button>
        </form>
        <br>
        <form action="/quote" method="post">
            <div class="mb-3">
                <input autocomplete="off" autofocus class="form-control mx-auto w-auto" id="symbol" name="symbol" placeholder="Symbol" type="text">
            </div>
            <br>
            <div>
                <button class="btn btn-primary" type="submit">Quote</button>
            </div>
        </form>
        <br>
        <form action="/sell" method="post">
            <div class="mb-3">
                <select name = symbol placeholder = "Symbol">
                    {% for stock in portfolio %}
                        <option value = "{{stock.stock_symbol}}">{{stock.stock_symbol}}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <input class="form-control mx-auto w-auto" name="shares" min = "1" placeholder="Number Of Shares" type="number">
            </div>
            <button class="btn btn-primary" type="submit">Sell</button>
        </form>
    </div>
</div>
<br>
<div class="container-fluid rounded p-4 shad opacity-75">
    <div class="row g-4">
        <div class="col-sm-12 col-xl-8">
            <div class="bg-light text-center text-light rounded p-4 shadow">
                <div class="d-flex align-items-center justify-content-between mb-4">
                    <h6 class="mb-0">Market Feed</h6>
                    <div>
                        <select class="form-select" aria-label="Default select example">
                            <option selected>This Month</option>
                            <option value="1">Last Month</option>
                        </select>
                    </div>
                </div>
                <!-- <canvas id="worldwide-sales"></canvas> -->
                <img id="news1_img">
                <h5 id="news1"></h5>
                <img id="news2_img">
                <h5 id="news2"></h5>
                <img id="news3_img">
                <h5 id="news3"></h5>
                <!-- <img src="static/img/feed.png" alt="Market Feed" class="container-fluid"> -->
            </div>
        </div>
        <div class="col-sm-12 col-xl-4">
            <div class="bg-light text-center rounded p-4 shadow h-100">
                <div class="d-flex align-items-center justify-content-between mb-4">
                    <h6 class="mb-0">My Top Performing Assets</h6>
                    <div>
                        <select class="form-select" aria-label="Default select example">
                            <option selected>This Month</option>
                            <option value="1">Last Month</option>
                        </select>
                    </div>
                </div>
                <div class="w-100 d-flex justify-content-center">
                    <div id="container" style="height: 370px; width: 450px;">
                        <div>
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th class="text-start">Symbol</th>
                                        <th class="text-end">Price</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for stock in assets %}
                                        <tr>
                                            <td class="text-start">{{stock.symbol}}</td>
                                            <td class="text-end">{{stock.price | usd}}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div>
                            <img src="static/img/AAPL.png" alt="Average performance of top performing assets" class="container-fluid">
                        </div>
                        <br><br><br><br><br><br>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        fetch("https://stocknewsapi.com/api/v1?tickers=META,AMZN,NFLX&items=3&page=1&token=qvgfptpokzmfkdag1opnwj9c2svtukxyseprol1n")
        .then(response => response.json())
        .then(result => {document.querySelector("#news1").innerHTML = result.data[0]["title"] + "<div>Date: " + result.data[0]["date"] + "</div>" + "<div style='color:green'>Sentiment: " + result.data[0]["sentiment"] + "</div>" + "\nLink to article: " + "<a style='color:blue' href=" + result.data[0]["news_url"] + ">" + result.data[0]["news_url"] + "</a>"
        document.querySelector("#news1_img").src = result.data[0]["image_url"]
        document.querySelector("#news2").innerHTML = result.data[1]["title"] + "<div>Date: " + result.data[1]["date"] + "</div>" + "<div style='color:green'>Sentiment: " + result.data[1]["sentiment"] + "</div>" + "\nLink to article: " + "<a style='color:blue' href=" + result.data[0]["news_url"] + ">" + result.data[1]["news_url"] + "</a>"
        document.querySelector("#news2_img").src = result.data[1]["image_url"]
        document.querySelector("#news3").innerHTML = result.data[2]["title"] + "<div>Date: " + result.data[2]["date"] + "</div>" + "<div style='color:green'>Sentiment: " + result.data[2]["sentiment"] + "</div>" + "\nLink to article: " + "<a style='color:blue' href=" + result.data[0]["news_url"] + ">" + result.data[2]["news_url"] + "</a>"
        document.querySelector("#news3_img").src = result.data[2]["image_url"]
    })
        .catch(err => console.log(err))
    });
</script>
{% endblock %}
