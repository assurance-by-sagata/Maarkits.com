{% extends "layout.html" %}

{% block title %}
    Quote
{% endblock %}

{% block main %}
    <div class="bg-dark text-center rounded p-4 shadow text-light opacity-75">
        The current share price of {{stock.symbol}}({{stock.name}}) is {{stock.price | usd}}
    </div>
    <br>
    <div class="row g-4">
        <div class="col-sm-12 col-xl-8">
            <div class="bg-light text-center text-light rounded p-4 shadow">
                <div class="d-flex align-items-center justify-content-between mb-4">
                    <h6 class="mb-0">Market Feed</h6>
                    <div>
                        <select class="form-select" aria-label="Default select example">
                            <option selected>This Month</option>
                            <option value="1">Last Month</option>
                        </select>
                    </div>
                </div>
                <!-- <canvas id="worldwide-sales"></canvas> -->
                <img id="news1_img">
                <h5 id="news1"></h5>
                <img id="news2_img">
                <h5 id="news2"></h5>
                <img id="news3_img">
                <h5 id="news3"></h5>
                <!-- <img src="static/img/feed.png" alt="Market Feed" class="container-fluid"> -->
            </div>
        </div>
        <div class="col-sm-12 col-xl-4">
            <div class="bg-light text-center rounded p-4 shadow h-100 opacity-75">
                <div class="d-flex align-items-center justify-content-between mb-4">
                    <h6 class="mb-0">{{stock.name}} Performance</h6>
                    <div>
                        <select class="form-select" aria-label="Default select example">
                            <option selected>This Month</option>
                            <option value="1">Last Month</option>
                        </select>
                    </div>
                </div>
                <div class="w-100 d-flex justify-content-center">
                    <div id="container" style="height: 370px; width: 450px;">
                        <div>
                            <table class="table table-hover table-dark">
                                <thead>
                                    <!-- <tr>
                                        <th class="text-start">Symbol</th>
                                        <th class="text-end">Price</th>
                                    </tr> -->
                                </thead>
                                <tbody>
                                    {% for stock in assets %}
                                        <tr>
                                            <td class="text-start">{{stock.symbol}}</td>
                                            <td class="text-end">{{stock.price | usd}}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div>
                            <img src="static/img/AAPL.png" alt="Average performance of top performing assets" class="container-fluid">
                        </div>
                        <br>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            fetch(`https://stocknewsapi.com/api/v1?tickers=${{stock.symbol}}&items=3&page=1&token=qvgfptpokzmfkdag1opnwj9c2svtukxyseprol1n`)
            .then(response => response.json())
            .then(result => {document.querySelector("#news1").innerHTML = result.data[0]["title"] + "<div>Date: " + result.data[0]["date"] + "</div>" + "<div style='color:green'>Sentiment: " + result.data[0]["sentiment"] + "</div>" + "\nLink to article: " + "<a style='color:blue' href=" + result.data[0]["news_url"] + ">" + result.data[0]["news_url"] + "</a>"
            document.querySelector("#news1_img").src = result.data[0]["image_url"]
            document.querySelector("#news2").innerHTML = result.data[1]["title"] + "<div>Date: " + result.data[1]["date"] + "</div>" + "<div style='color:green'>Sentiment: " + result.data[1]["sentiment"] + "</div>" + "\nLink to article: " + "<a style='color:blue' href=" + result.data[0]["news_url"] + ">" + result.data[1]["news_url"] + "</a>"
            document.querySelector("#news2_img").src = result.data[1]["image_url"]
            document.querySelector("#news3").innerHTML = result.data[2]["title"] + "<div>Date: " + result.data[2]["date"] + "</div>" + "<div style='color:green'>Sentiment: " + result.data[2]["sentiment"] + "</div>" + "\nLink to article: " + "<a style='color:blue' href=" + result.data[0]["news_url"] + ">" + result.data[2]["news_url"] + "</a>"
            document.querySelector("#news3_img").src = result.data[2]["image_url"]
        })
            .catch(err => console.log(err))
        });
    </script>
{% endblock %}
